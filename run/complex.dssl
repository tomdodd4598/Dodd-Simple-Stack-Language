# --------------- #
# COMPLEX NUMBERS #
# --------------- #

$math include

/Complex {
	/__init__ {
		/this exch def
		/this .im exch def
		/this .re exch def
		this
	} macro
	
	/__eq__ {
		dup .re /xre exch def .im /xim exch def
		dup .re /yre exch def .im /yim exch def
		xre yre == xim yim == &
	} macro
	
	/__ne__ {
		dup .re /xre exch def .im /xim exch def
		dup .re /yre exch def .im /yim exch def
		xre yre != xim yim != |
	} macro
	
	/__add__ {
		dup .re /xre exch def .im /xim exch def
		dup .re /yre exch def .im /yim exch def
		xre yre + xim yim + Complex new
	} macro
	
	/__sub__ {
		dup .re /xre exch def .im /xim exch def
		dup .re /yre exch def .im /yim exch def
		xre yre - xim yim - Complex new
	} macro
	
	/__mul__ {
		dup .re /xre exch def .im /xim exch def
		dup .re /yre exch def .im /yim exch def
		xre yre * xim yim * - xre yim * xim yre * + Complex new
	} macro
	
	/__div__ {
		dup .re /xre exch def .im /xim exch def
		dup .re /yre exch def .im /yim exch def
		/ysq yre yre * yim yim * + def
		xre yre * xim yim * + ysq / xim yre * xre yim * - ysq / Complex new
	} macro
	
	/__pow__ {
		dup .abs ln /xlnr exch def .arg /xtheta exch def
		dup .re /yre exch def .im /yim exch def
		xlnr yre * xtheta yim * - exp xtheta yre * xlnr yim * + Complex .fromPolar
	} macro
	
	/__str__ {
		/this exch def
		this .re
		this .im 0.0 >= { '+' ~ } if
		this .im ~ 'i' ~
	} macro
	
	/abs {
		dup .re /re exch def .im /im exch def
		re re * im im * + sqrt
	} macro
	
	/arg {
		dup .im exch .re atan2
	} macro
	
	/fromPolar {
		/theta exch def
		/r exch def
		r theta cos * r theta sin * Complex new
	} macro
} class

/a 2.7 3.4 Complex new def
/b 4.2 -1.9 Complex new def

"a = " a ~ println
"b = " b ~ println

'\n' print

"abs(a) = " a .abs ~ println
"arg(b) = " b .arg ~ println

'\n' print

"a+b = " a b + ~ println
"a-b = " a b - ~ println
"a*b = " a b * ~ println
"a/b = " a b / ~ println
"a**b = " a b ** ~ println
